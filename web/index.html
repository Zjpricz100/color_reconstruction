<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1 - Prokudin-Gorskii Color Reconstruction</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        /* Project-specific styles */
        .project-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            padding: var(--spacing-xl) 0;
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            color: white;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .back-link::before {
            content: "←";
            margin-right: var(--spacing-xs);
            font-weight: bold;
        }
        
        .project-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }
        
        .section {
            margin-bottom: var(--spacing-2xl);
        }
        
        .section h2 {
            color: var(--text-primary);
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: var(--spacing-xs);
        }
        
        .section h3 {
            color: var(--text-primary);
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-sm);
            margin-top: var(--spacing-lg);
        }
        
        .section p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: var(--spacing-md);
        }
        
        .section ul {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: var(--spacing-md);
            padding-left: var(--spacing-lg);
        }
        
        .section li {
            margin-bottom: var(--spacing-xs);
        }
        
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }
        
        .image-container {
            text-align: center;
        }
        
        .image-container img {
            width: 100%;
            max-width: 400px;
            height: auto;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        
        .image-container img:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-lg);
        }
        
        .image-caption {
            margin-top: var(--spacing-sm);
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .displacement-info {
            margin-top: var(--spacing-xs);
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            line-height: 1.4;
        }
        
        .code-block {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            font-family: 'Courier New', monospace;
            font-size: var(--font-size-sm);
            overflow-x: auto;
        }
        
        .highlight {
            background-color: rgba(132, 204, 22, 0.1);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--accent-color);
        }
        
        .math-formula {
            text-align: center;
            margin: var(--spacing-lg) 0;
            padding: var(--spacing-md);
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }
        
        .gif-section {
            text-align: center;
            margin: var(--spacing-lg) 0 var(--spacing-2xl) 0;
        }
        
        .gif-image {
            max-width: 100%;
            height: auto;
            box-shadow: var(--shadow-md);
        }
        
        @media (max-width: 768px) {
            .project-content {
                padding: 0 var(--spacing-sm);
            }
            
            .image-gallery {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <header class="project-header">
        <div class="container">
            <a href="../../index.html" class="back-link">Back to Portfolio</a>
            <h1 class="title">Project 1</h1>
            <p class="subtitle">Images of the Russian Empire</p>
        </div>
    </header>

    <main class="main">
        <div class="project-content">
            <div class="gif-section">
                <img src="all_output.gif" alt="All Output Animation" class="gif-image">
            </div>
            
            <section class="section">
                <h2>Project Overview</h2>
                <p>This project focuses on reconstructing color images from the digitized glass plate negatives of Sergei Mikhailovich Prokudin-Gorskii, a Russian photographer who pioneered color photography in the early 1900s. Prokudin-Gorskii captured thousands of color photographs by taking three separate exposures of each scene using red, green, and blue filters, recording them onto glass plates.</p>
                
                <p>The challenge lies in automatically aligning these three color channel images to produce a single, artifact-free RGB color image. For this project, I explored grid searching to find that optimal alignment, and using an image pyramid to speed things up for larger images.</p>
                
                <div class="highlight">
                    <strong>Key Challenge:</strong> The glass plate images are very large (especially the .tif files), so the alignment procedure must be both accurate and computationally efficient.
                </div>
            </section>

            <section class="section">
                <h2>Algorithm</h2>
                <p>The algorithm starts with preprocessing. I first convert the images to float for memory efficiency, then separate the images into their respective color channels. With each channel sepearted, I then demean each image, crop out the border (roughly 5% of each side), then find the neccesary displacements along each axis to align the blue channel to the green channel, and I do the same for aligning the red channel to the green channel. The green channel serves as the reference channel for alignment. </p>

                <h3>Single-Scale Alignment</h3>
                <p>For low resolution images, it is sufficient to search over a small window of possible displacements (e.g. [-15, 15] pixels), and compute a similarity metric for each candidate displacement value. The displacement values that perform best with that given metric are chosen, and I align the input channel to the reference channel with those displacement values. Once the blue channel and red channel are sufficiently aligned relative to the reference channel, all three channels can be stacked to form the final color image! We have successfully brought color to the Russian Empire!</p>

                
                <h3>Image Matching Metrics</h3>
                <p>Picking which metric to use is an important design choice that will effect the performance of the algorithm, especially for tricker images like that of the Emir of Bukhara. I first experimented with using simply just the L2 norm (Euclidean Distance) to measure the similarity between the channel and the reference channel(Note that I1 and I2 are two images being compared).</p>
                
                <div class="math-formula">
                    $$\text{L2}(I_1, I_2) = \sqrt{\sum_{i,j} (I_1(i,j) - I_2(i,j))^2}$$
                </div>

                <p>While this metric is simple and computationally efficient, for certain images it is not robust enough to accurately align the channels. This can be seen below with a somewhat hazy image of this monastery. </p>

                <div class="image-container">
                    <img src="../code/output/bad_monastery.png" alt="Bad Monastery Reconstruction">
                    <div class="image-caption"></div>
                </div>
                
                
                <p>To remedy this, and introduce more robustness to the alignment algorithm I used the Normalized Cross-Correlation (NCC) metric. Using this, and finding the alignments where NCC is maximized provided significantly better results.</p>

                <div class="math-formula"> 
                    $$\text{NCC}(I_1, I_2) = \frac{\sum_{i,j} (I_1(i,j) - \mu_1)(I_2(i,j) - \mu_2)}{\sqrt{\sum_{i,j} (I_1(i,j) - \mu_1)^2 \sum_{i,j} (I_2(i,j) - \mu_2)^2}}$$
                </div>

                <div class="image-container">
                    <img src="../code/output/monastery.jpg" alt="Monastery Reconstruction">
                    <div class="image-caption"></div>
                </div>
                
                <h3>Multiscale Implementation and Image Pyramid</h3>
                <p>For large images, exhaustive search becomes prohibitively expensive. To account for large resolution images, I implemented an image pyramid approach that processes images at multiple scales, starting from the coarsest (smallest) scale and refining the alignment estimate as it progresses down the pyramid to finer images. In particular, each image size is doubled from one layer of the pyramid to the next. This means that each step down the pyramid, we are much closer to our optimal displacements, allowing us to search over a smaller window, improving the performance of the algorithm dramatically. For this project specifically, I chose to half the search space each time I traverse a layer down the pyramid. This allowed for accurate, but computationally efficient alignment for large image sizes</p>
                
                <div class="highlight">
                    <strong>Note:</strong> The image pyramid implementation relies heavily on how images are resized/downsampled. At first, I used a 5x5 gaussian kernel and convolved it with the original image, then cut out every other pixel. I later chose to use the resize function from skimage directly however both approaches provided good results.
                </div>
            </section>

            <section class="section">
                <h2>Results</h2>
                <p>Below are the results of my color reconstruction algorithm on various Prokudin-Gorskii images. Each image shows the final aligned color reconstruction along with the calculated displacement vectors for both blue-to-green and red-to-green alignments.</p>
                
                <div class="image-gallery">
                    <div class="image-container">
                        <img src="../code/output/cathedral.jpg" alt="Cathedral Reconstruction">
                        <div class="image-caption">Cathedral</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-2, -5) pixels<br>
                            <strong>Red → Green:</strong> (1, 7) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/monastery.jpg" alt="Monastery Reconstruction">
                        <div class="image-caption">Monastery</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-2, 3) pixels<br>
                            <strong>Red → Green:</strong> (1, 6) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/emir.jpg" alt="Emir Reconstruction">
                        <div class="image-caption">Emir of Bukhara</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-24, -50) pixels<br>
                            <strong>Red → Green:</strong> (18, 56) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/church.jpg" alt="Church Reconstruction">
                        <div class="image-caption">Church</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-4, -26) pixels<br>
                            <strong>Red → Green:</strong> (-8, 34) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/harvesters.jpg" alt="Harvesters Reconstruction">
                        <div class="image-caption">Harvesters</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-16, -60) pixels<br>
                            <strong>Red → Green:</strong> (-2, 64) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/icon.jpg" alt="Icon Reconstruction">
                        <div class="image-caption">Icon</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-16, -40) pixels<br>
                            <strong>Red → Green:</strong> (6, 48) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/italil.jpg" alt="Italil Reconstruction">
                        <div class="image-caption">Italil</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-20, -38) pixels<br>
                            <strong>Red → Green:</strong> (14, 38) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/lastochikino.jpg" alt="Lastochikino Reconstruction">
                        <div class="image-caption">Lastochikino</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (2, 2) pixels<br>
                            <strong>Red → Green:</strong> (-6, 78) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/lugano.jpg" alt="Lugano Reconstruction">
                        <div class="image-caption">Lugano</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (16, -40) pixels<br>
                            <strong>Red → Green:</strong> (-12, 52) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/melons.jpg" alt="Melons Reconstruction">
                        <div class="image-caption">Melons</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-10, -82) pixels<br>
                            <strong>Red → Green:</strong> (4, 96) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/self_portrait.jpg" alt="Self Portrait Reconstruction">
                        <div class="image-caption">Self Portrait</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-28, -78) pixels<br>
                            <strong>Red → Green:</strong> (8, 98) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/siren.jpg" alt="Siren Reconstruction">
                        <div class="image-caption">Siren</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (6, 50) pixels<br>
                            <strong>Red → Green:</strong> (-18, 46) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/three_generations.jpg" alt="Three Generations Reconstruction">
                        <div class="image-caption">Three Generations</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-14, -54) pixels<br>
                            <strong>Red → Green:</strong> (-2, 58) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/tobolsk.jpg" alt="Tobolsk Reconstruction">
                        <div class="image-caption">Tobolsk</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-3, -3) pixels<br>
                            <strong>Red → Green:</strong> (1, 4) pixels
                        </div>
                    </div>
                </div>
            </section>

 

            <section class="section">
                <h2>Personal Images</h2>
                <p>I also tested my algorithm on additional images from the Prokudin-Gorskii collection to demonstrate its robustness across different types of scenes and photographic conditions. The owls are my favorite!</p>
                
                <div class="image-gallery">
                    <div class="image-container">
                        <img src="../code/output/bird.jpg" alt="Bird Reconstruction">
                        <div class="image-caption">Ural Owls - Personal Selection</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-50, -38) pixels<br>
                            <strong>Red → Green:</strong> (34, 52) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/ship.jpg" alt="Ship Reconstruction">
                        <div class="image-caption">Sailboats - Personal Selection</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-24, -30) pixels<br>
                            <strong>Red → Green:</strong> (20, 82) pixels
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img src="../code/output/camel.jpg" alt="Camel Reconstruction">
                        <div class="image-caption">Camel Caravan - Personal Selection</div>
                        <div class="displacement-info">
                            <strong>Blue → Green:</strong> (-24, -68) pixels<br>
                            <strong>Red → Green:</strong> (16, 78) pixels
                        </div>
                    </div>
                </div>
            </section>

            <section class="section">
                <h2>Conclusion</h2>
                <p>By using modern image processing techniques it is possible with relative ease to bring beautiful color to Sergei Prokudin-Gorskii's original collection. Further improvements can be made by experimenting with different metrics as well as exploring possibly better representation of pixel features, but using very simple tools and techniques, we are able to create beautiful color images of the Russian Empire.</p>
                
         
                
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 CS180 Portfolio - Project 1</p>
        </div>
    </footer>
</body>
</html>
